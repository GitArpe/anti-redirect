// ==UserScript==
// @name              anti-redirect (typescript)
// @author            Axetroy
// @collaborator      Axetroy
// @description       GM脚本, 去除各搜索引擎/常用网站的重定向
// @version           2.1.0
// @update            2017-09-04 00:21:41
// @grant             GM_xmlhttpRequest
// @include           *www.baidu.com*
// @include           *tieba.baidu.com*
// @include           *v.baidu.com*
// @include           *www.google.*
// @include           *docs.google.*
// @include           *encrypted.google.com*
// @include           *www.so.com*
// @include           *www.zhihu.com*
// @include           *daily.zhihu.com*
// @include           *zhuanlan.zhihu.com*
// @include           *weibo.com*
// @include           *twitter.com*
// @include           *www.sogou.com*
// @connect           *
// @compatible        chrome  完美运行
// @compatible        firefox  完美运行
// @supportURL        http://www.burningall.com
// @run-at            document-start
// @contributionURL   troy450409405@gmail.com|alipay.com
// @downloadURL       https://github.com/axetroy/anti-redirect/raw/master/dist/anti-redirect.min.user.js
// @namespace         https://greasyfork.org/zh-CN/users/3400-axetroy
// @license           The MIT License (MIT); http://opensource.org/licenses/MIT
// ==/UserScript==

// Github源码:https://github.com/axetroy/anti-redirect


!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this.test=/example/,this.config={debug:!1}}return t.prototype.setConfig=function(t){return this.config=t,this},t.prototype.onScroll=function(t){},t.prototype.onHover=function(t){},t.prototype.onInit=function(){return this},t}();e.Provider=r},function(t,e,n){"use strict";function r(t,e,n){var r=e.exec(t.href);if(r&&r.length&&r[1]){var o="";try{o=decodeURIComponent(r[1])}catch(t){o=/https?:\/\//.test(r[1])?r[1]:""}o&&(t.setAttribute("origin-href",t.getAttribute("href")),t.href=o,n&&(t.style.backgroundColor="green"))}}function o(t){return new v(t)}function i(t){return(t.innerText||t.textContent).trim()}function u(t,e){return void 0===e&&(e={}),function(n,r,o){return{configurable:!0,enumerable:o.enumerable,get:function(){return Object.defineProperty(this,r,{configurable:!0,enumerable:o.enumerable,value:p(o.value,t,e)}),this[r]}}}}function c(t,e){return void 0===e&&(e={}),function(n,r,o){return{configurable:!0,enumerable:o.enumerable,get:function(){return Object.defineProperty(this,r,{configurable:!0,enumerable:o.enumerable,value:h(o.value,t,e)}),this[r]}}}}function s(t){return d.is(t)}function f(t){return+(t.getAttribute(e.REDIRECT_NUM)||0)}function a(t){var n=f(t);t.setAttribute(e.REDIRECT_NUM,n+1+"")}function l(t){var n=f(t);n>0&&t.setAttribute(e.REDIRECT_NUM,n-1+"")}Object.defineProperty(e,"__esModule",{value:!0});var p=n(10),h=n(11),d=n(12);e.REDIRECT_NUM="redirect-num",e.antiRedirect=r;var v=function(){function t(t){this.queryStr=t,this.object={},this.object=this.toObject(t.replace(/^\?+/,""))}return t.prototype.toObject=function(t){var e={};return t.split("&").forEach(function(t){var n=t.split("=")||[],r=n[0]||"",o=n[1]||"";try{r=decodeURIComponent(n[0]||""),o=decodeURIComponent(n[1]||"")}catch(t){}r&&(e[r]=o)}),e},t.prototype.toString=function(){var t=[];for(var e in this.object)if(this.object.hasOwnProperty(e)){var n=this.object[e];t.push(e+"="+n)}return t.length?"?"+t.join("&"):""},t}();e.queryParser=o,e.getText=i,e.throttleDecorator=u,e.debounceDecorator=c,e.isInView=s,e.getRedirect=f,e.increaseRedirect=a,e.decreaseRedirect=l},function(t,e,n){!function(e,n){t.exports=n()}(0,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";function r(t){return"function"==typeof t}var o=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t};Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){void 0===t&&(t={}),this.config=t}return t.prototype.setConfig=function(t){void 0===t&&(t={}),this.config=o({},this.config,t)},t.prototype.create=function(e){return new t(e)},t.prototype.request=function(t,e,n,i,u){var c=this;return void 0===n&&(n=""),void 0===i&&(i={}),void 0===u&&(u={}),new Promise(function(s,f){var a={method:t,url:e,data:n,header:i},l=o({},a,u,c.config),p=l.onreadystatechange,h=l.onerror,d=l.onabort,v=l.ontimeout;l.synchronous=!0,l.onreadystatechange=function(t){try{r(p)&&p.call(this,t)}catch(t){f(t)}4===t.readyState&&(t.status>=200&&t.status<400?s(t):f(t))},l.onerror=function(t){try{r(h)&&h.call(this,t),f(t)}catch(t){f(t)}},l.onabort=function(t){try{r(d)&&d.call(this,t),f(t)}catch(t){f(t)}},l.ontimeout=function(t){try{r(v)&&v.call(this,t),f(t)}catch(t){f(t)}},c.config.debug&&console.log("%c["+a.method.toUpperCase()+"]%c: "+a.url,"color: green","color: #000;text-style: under-line"),GM_xmlhttpRequest(o({},l))})},t.prototype.get=function(t,e,n,r){return this.request("GET",t,e,n,r)},t.prototype.post=function(t,e,n,r){return this.request("POST",t,e,n,r)},t.prototype.put=function(t,e,n,r){return this.request("PUT",t,e,n,r)},t.prototype.delete=function(t,e,n,r){return this.request("DELETE",t,e,n,r)},t.prototype.head=function(t,e,n,r){return this.request("HEAD",t,e,n,r)},t}();e.Http=i;e.timeout=5e3;var u=new i({timeout:5e3});e.http=u,e.default=u}])})},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(5);var r=n(2),o=n(9),i=n(13),u=n(14),c=n(15),s=n(16),f=n(17),a=n(18),l=n(19),p=n(20),h=n(21),d=n(22),v=n(23),y=n(24),b=new o.App;r.default.setConfig({debug:!1}),b.setConfig({debug:!1}).provide([{name:"知乎",test:/www\.zhihu\.com/,provider:a.ZhihuProvider},{name:"知乎专栏",test:/zhuanlan\.zhihu\.com/,provider:i.ZhihuZhuanlanProvider},{name:"知乎日报",test:/daily\.zhihu\.com/,provider:u.ZhihuDailyProvider},{name:"Google搜索",test:/\w+\.google\./,provider:s.GoogleProvider},{name:"Google Docs",test:/docs\.google\.com/,provider:f.GoogleDocsProvider},{name:"360搜索",test:/www\.so\.com/,provider:l.SoProvider},{name:"新浪微博",test:/\.weibo\.com/,provider:p.WeboProvider},{name:"Twitter",test:/twitter\.com/,provider:h.TwitterProvider},{name:"搜狗搜索",test:/www\.sogou\.com/,provider:d.SoGouProvider},{name:"百度搜索",test:/www\.baidu\.com/,provider:v.BaiduProvider},{name:"百度视频",test:/v\.baidu\.com/,provider:y.BaiduVideoProvider},{name:"百度贴吧",test:/tieba\.baidu\.com/,provider:c.TiebaProvider}]).bootstrap()},function(t,e,n){"use strict";t.exports=n(6).polyfill()},function(t,e,n){(function(e,r){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   4.1.1
 */
!function(e,n){t.exports=n()}(0,function(){"use strict";function t(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}function o(t){return"function"==typeof t}function i(t){Z=t}function u(t){F=t}function c(){return void 0!==$?function(){$(f)}:s()}function s(){var t=setTimeout;return function(){return t(f,1)}}function f(){for(var t=0;t<z;t+=2){(0,Q[t])(Q[t+1]),Q[t]=void 0,Q[t+1]=void 0}z=0}function a(t,e){var n=arguments,r=this,o=new this.constructor(p);void 0===o[tt]&&R(o);var i=r._state;return i?function(){var t=n[i-1];F(function(){return E(i,o,t,r._result)})}():j(r,o,t,e),o}function l(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(p);return m(n,t),n}function p(){}function h(){return new TypeError("You cannot resolve a promise with itself")}function d(){return new TypeError("A promises callback cannot return that same promise.")}function v(t){try{return t.then}catch(t){return ot.error=t,ot}}function y(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}function b(t,e,n){F(function(t){var r=!1,o=y(n,e,function(n){r||(r=!0,e!==n?m(t,n):O(t,n))},function(e){r||(r=!0,P(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,P(t,o))},t)}function _(t,e){e._state===nt?O(t,e._result):e._state===rt?P(t,e._result):j(e,void 0,function(e){return m(t,e)},function(e){return P(t,e)})}function g(t,e,n){e.constructor===t.constructor&&n===a&&e.constructor.resolve===l?_(t,e):n===ot?(P(t,ot.error),ot.error=null):void 0===n?O(t,e):o(n)?b(t,e,n):O(t,e)}function m(e,n){e===n?P(e,h()):t(n)?g(e,n,v(n)):O(e,n)}function w(t){t._onerror&&t._onerror(t._result),x(t)}function O(t,e){t._state===et&&(t._result=e,t._state=nt,0!==t._subscribers.length&&F(x,t))}function P(t,e){t._state===et&&(t._state=rt,t._result=e,F(w,t))}function j(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+nt]=n,o[i+rt]=r,0===i&&t._state&&F(x,t)}function x(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,o=void 0,i=t._result,u=0;u<e.length;u+=3)r=e[u],o=e[u+n],r?E(n,r,o,i):o(i);t._subscribers.length=0}}function T(){this.error=null}function A(t,e){try{return t(e)}catch(t){return it.error=t,it}}function E(t,e,n,r){var i=o(n),u=void 0,c=void 0,s=void 0,f=void 0;if(i){if(u=A(n,r),u===it?(f=!0,c=u.error,u.error=null):s=!0,e===u)return void P(e,d())}else u=r,s=!0;e._state!==et||(i&&s?m(e,u):f?P(e,c):t===nt?O(e,u):t===rt&&P(e,u))}function S(t,e){try{e(function(e){m(t,e)},function(e){P(t,e)})}catch(e){P(t,e)}}function M(){return ut++}function R(t){t[tt]=ut++,t._state=void 0,t._result=void 0,t._subscribers=[]}function C(t,e){this._instanceConstructor=t,this.promise=new t(p),this.promise[tt]||R(this.promise),G(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?O(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&O(this.promise,this._result))):P(this.promise,k())}function k(){return new Error("Array Methods must be provided an Array")}function H(t){return new C(this,t).promise}function D(t){var e=this;return new e(G(t)?function(n,r){for(var o=t.length,i=0;i<o;i++)e.resolve(t[i]).then(n,r)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function U(t){var e=this,n=new e(p);return P(n,t),n}function I(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function L(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function N(t){this[tt]=M(),this._result=this._state=void 0,this._subscribers=[],p!==t&&("function"!=typeof t&&I(),this instanceof N?S(this,t):L())}function q(){var t=void 0;if(void 0!==r)t=r;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=N}var W=void 0;W=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var G=W,z=0,$=void 0,Z=void 0,F=function(t,e){Q[z]=t,Q[z+1]=e,2===(z+=2)&&(Z?Z(f):X())},V="undefined"!=typeof window?window:void 0,B=V||{},Y=B.MutationObserver||B.WebKitMutationObserver,K="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),J="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Q=new Array(1e3),X=void 0;X=K?function(){return function(){return e.nextTick(f)}}():Y?function(){var t=0,e=new Y(f),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}():J?function(){var t=new MessageChannel;return t.port1.onmessage=f,function(){return t.port2.postMessage(0)}}():void 0===V?function(){try{var t=n(8);return $=t.runOnLoop||t.runOnContext,c()}catch(t){return s()}}():s();var tt=Math.random().toString(36).substring(16),et=void 0,nt=1,rt=2,ot=new T,it=new T,ut=0;return C.prototype._enumerate=function(t){for(var e=0;this._state===et&&e<t.length;e++)this._eachEntry(t[e],e)},C.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===l){var o=v(t);if(o===a&&t._state!==et)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(n===N){var i=new n(p);g(i,t,o),this._willSettleAt(i,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},C.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===et&&(this._remaining--,t===rt?P(r,n):this._result[e]=n),0===this._remaining&&O(r,this._result)},C.prototype._willSettleAt=function(t,e){var n=this;j(t,void 0,function(t){return n._settledAt(nt,e,t)},function(t){return n._settledAt(rt,e,t)})},N.all=H,N.race=D,N.resolve=l,N.reject=U,N._setScheduler=i,N._setAsap=u,N._asap=F,N.prototype={constructor:N,then:a,catch:function(t){return this.then(null,t)}},N.polyfill=q,N.Promise=N,N})}).call(e,n(7),n(3))},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(a===setTimeout)return setTimeout(t,0);if((a===n||!a)&&setTimeout)return a=setTimeout,setTimeout(t,0);try{return a(t,0)}catch(e){try{return a.call(null,t,0)}catch(e){return a.call(this,t,0)}}}function i(t){if(l===clearTimeout)return clearTimeout(t);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function u(){v&&h&&(v=!1,h.length?d=h.concat(d):y=-1,d.length&&c())}function c(){if(!v){var t=o(u);v=!0;for(var e=d.length;e;){for(h=d,d=[];++y<e;)h&&h[y].run();y=-1,e=d.length}h=null,v=!1,i(t)}}function s(t,e){this.fun=t,this.array=e}function f(){}var a,l,p=t.exports={};!function(){try{a="function"==typeof setTimeout?setTimeout:n}catch(t){a=n}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(t){l=r}}();var h,d=[],v=!1,y=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];d.push(new s(t,e)),1!==d.length||v||o(c)},s.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=f,p.addListener=f,p.once=f,p.off=f,p.removeListener=f,p.removeAllListeners=f,p.emit=f,p.binding=function(t){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(t,e){},function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var o,i=arguments.length,u=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(u=(i<3?o(u):i>3?o(e,n,u):o(e,n))||u);return i>3&&u&&Object.defineProperty(e,n,u),u};Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),i=function(){function t(){this.provides=[],this.onScrollHandler=[],this.onHoverHandler=[]}return t.prototype.setConfig=function(t){return this.config=t,this},t.prototype.provide=function(t){return this.provides=t,this},t.prototype.getProvider=function(){for(var t=[],e=this.provides.slice();e.length;){var n=e.shift();n.test.test(document.domain)&&t.push(n)}return t},t.prototype.onHover=function(t){var e=t.target;"A"===e.tagName&&this.onHoverHandler.forEach(function(t){t(e)})},t.prototype.onScroll=function(){var t=[].slice.call(document.querySelectorAll('a[href^="http"]')).filter(function(t){return o.isInView(t)&&o.getRedirect(t)<=2});this.onScrollHandler.forEach(function(e){e(t)})},t.prototype.bootstrap=function(){var t=this;addEventListener("DOMContentLoaded",function(){for(var e=t.getProvider();e.length;){var n=e.shift();console.info("[Anti-redirect]: Load "+n.name);var r=n.provider,o=(new r).setConfig(t.config).onInit();t.onScrollHandler.push(o.onScroll.bind(o)),t.onHoverHandler.push(o.onHover.bind(o))}}),addEventListener("scroll",this.onScroll.bind(this)),addEventListener("mousemove",this.onHover.bind(this)),console.log("%c Anti-Redirect %c Copyright © 2015-%s %s",'font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;font-size:64px;color:#00bbee;-webkit-text-fill-color:#00bbee;-webkit-text-stroke: 1px #00bbee;',"font-size:12px;color:#999999;",(new Date).getFullYear(),"\nAuthor @Axetroy")},r([o.debounceDecorator(300)],t.prototype,"onScroll",null),t}();e.App=i},function(t,e,n){(function(e){function n(t,e,n){function r(e){var n=v,r=y;return v=y=void 0,j=e,_=t.apply(r,n)}function i(t){return j=t,g=setTimeout(a,e),x?r(t):_}function u(t){var n=t-m,r=t-j,o=e-n;return T?O(o,b-r):o}function f(t){var n=t-m,r=t-j;return void 0===m||n>=e||n<0||T&&r>=b}function a(){var t=P();if(f(t))return l(t);g=setTimeout(a,u(t))}function l(t){return g=void 0,A&&v?r(t):(v=y=void 0,_)}function p(){void 0!==g&&clearTimeout(g),j=0,v=m=y=g=void 0}function h(){return void 0===g?_:l(P())}function d(){var t=P(),n=f(t);if(v=arguments,y=this,m=t,n){if(void 0===g)return i(m);if(T)return g=setTimeout(a,e),r(m)}return void 0===g&&(g=setTimeout(a,e)),_}var v,y,b,_,g,m,j=0,x=!1,T=!1,A=!0;if("function"!=typeof t)throw new TypeError(s);return e=c(e)||0,o(n)&&(x=!!n.leading,T="maxWait"in n,b=T?w(c(n.maxWait)||0,e):b,A="trailing"in n?!!n.trailing:A),d.cancel=p,d.flush=h,d}function r(t,e,r){var i=!0,u=!0;if("function"!=typeof t)throw new TypeError(s);return o(r)&&(i="leading"in r?!!r.leading:i,u="trailing"in r?!!r.trailing:u),n(t,e,{leading:i,maxWait:e,trailing:u})}function o(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function i(t){return!!t&&"object"==typeof t}function u(t){return"symbol"==typeof t||i(t)&&m.call(t)==a}function c(t){if("number"==typeof t)return t;if(u(t))return f;if(o(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(l,"");var n=h.test(t);return n||d.test(t)?v(t.slice(2),n?2:8):p.test(t)?f:+t}var s="Expected a function",f=NaN,a="[object Symbol]",l=/^\s+|\s+$/g,p=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,d=/^0o[0-7]+$/i,v=parseInt,y="object"==typeof e&&e&&e.Object===Object&&e,b="object"==typeof self&&self&&self.Object===Object&&self,_=y||b||Function("return this")(),g=Object.prototype,m=g.toString,w=Math.max,O=Math.min,P=function(){return _.Date.now()};t.exports=r}).call(e,n(3))},function(t,e,n){(function(e){function n(t,e,n){function o(e){var n=v,r=y;return v=y=void 0,j=e,_=t.apply(r,n)}function i(t){return j=t,g=setTimeout(a,e),x?o(t):_}function s(t){var n=t-P,r=t-j,o=e-n;return T?w(o,b-r):o}function f(t){var n=t-P,r=t-j;return void 0===P||n>=e||n<0||T&&r>=b}function a(){var t=O();if(f(t))return l(t);g=setTimeout(a,s(t))}function l(t){return g=void 0,A&&v?o(t):(v=y=void 0,_)}function p(){void 0!==g&&clearTimeout(g),j=0,v=P=y=g=void 0}function h(){return void 0===g?_:l(O())}function d(){var t=O(),n=f(t);if(v=arguments,y=this,P=t,n){if(void 0===g)return i(P);if(T)return g=setTimeout(a,e),o(P)}return void 0===g&&(g=setTimeout(a,e)),_}var v,y,b,_,g,P,j=0,x=!1,T=!1,A=!0;if("function"!=typeof t)throw new TypeError(c);return e=u(e)||0,r(n)&&(x=!!n.leading,T="maxWait"in n,b=T?m(u(n.maxWait)||0,e):b,A="trailing"in n?!!n.trailing:A),d.cancel=p,d.flush=h,d}function r(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function o(t){return!!t&&"object"==typeof t}function i(t){return"symbol"==typeof t||o(t)&&g.call(t)==f}function u(t){if("number"==typeof t)return t;if(i(t))return s;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var n=p.test(t);return n||h.test(t)?d(t.slice(2),n?2:8):l.test(t)?s:+t}var c="Expected a function",s=NaN,f="[object Symbol]",a=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,p=/^0b[01]+$/i,h=/^0o[0-7]+$/i,d=parseInt,v="object"==typeof e&&e&&e.Object===Object&&e,y="object"==typeof self&&self&&self.Object===Object&&self,b=v||y||Function("return this")(),_=Object.prototype,g=_.toString,m=Math.max,w=Math.min,O=function(){return b.Date.now()};t.exports=n}).call(e,n(3))},function(t,e,n){/*!
 * in-view 0.6.1 - Get notified when a DOM element enters or exits the viewport.
 * Copyright (c) 2016 Cam Wiegert <cam@camwiegert.com> - https://camwiegert.github.io/in-view
 * License: MIT
 */
!function(e,n){t.exports=n()}(0,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";var r=n(2),o=function(t){return t&&t.__esModule?t:{default:t}}(r);t.exports=o.default},function(t,e){function n(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}t.exports=n},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(9),i=r(o),u=n(3),c=r(u),s=n(4);e.default=function(){if("undefined"!=typeof window){var t=["scroll","resize","load"],e={history:[]},n={offset:{},threshold:0,test:s.inViewport},r=(0,i.default)(function(){e.history.forEach(function(t){e[t].check()})},100);t.forEach(function(t){return addEventListener(t,r)}),window.MutationObserver&&addEventListener("DOMContentLoaded",function(){new MutationObserver(r).observe(document.body,{attributes:!0,childList:!0,subtree:!0})});var o=function(t){if("string"==typeof t){var r=[].slice.call(document.querySelectorAll(t));return e.history.indexOf(t)>-1?e[t].elements=r:(e[t]=(0,c.default)(r,n),e.history.push(t)),e[t]}};return o.offset=function(t){if(void 0===t)return n.offset;var e=function(t){return"number"==typeof t};return["top","right","bottom","left"].forEach(e(t)?function(e){return n.offset[e]=t}:function(r){return e(t[r])?n.offset[r]=t[r]:null}),n.offset},o.threshold=function(t){return"number"==typeof t&&t>=0&&t<=1?n.threshold=t:n.threshold},o.test=function(t){return"function"==typeof t?n.test=t:n.test},o.is=function(t){return n.test(t,n)},o.offset(0),o}}()},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(e,r){n(this,t),this.options=r,this.elements=e,this.current=[],this.handlers={enter:[],exit:[]},this.singles={enter:[],exit:[]}}return r(t,[{key:"check",value:function(){var t=this;return this.elements.forEach(function(e){var n=t.options.test(e,t.options),r=t.current.indexOf(e),o=r>-1,i=n&&!o,u=!n&&o;i&&(t.current.push(e),t.emit("enter",e)),u&&(t.current.splice(r,1),t.emit("exit",e))}),this}},{key:"on",value:function(t,e){return this.handlers[t].push(e),this}},{key:"once",value:function(t,e){return this.singles[t].unshift(e),this}},{key:"emit",value:function(t,e){for(;this.singles[t].length;)this.singles[t].pop()(e);for(var n=this.handlers[t].length;--n>-1;)this.handlers[t][n](e);return this}}]),t}();e.default=function(t,e){return new o(t,e)}},function(t,e){"use strict";function n(t,e){var n=t.getBoundingClientRect(),r=n.top,o=n.right,i=n.bottom,u=n.left,c=n.width,s=n.height,f={t:i,r:window.innerWidth-u,b:window.innerHeight-r,l:o},a={x:e.threshold*c,y:e.threshold*s};return f.t>e.offset.top+a.y&&f.r>e.offset.right+a.x&&f.b>e.offset.bottom+a.y&&f.l>e.offset.left+a.x}Object.defineProperty(e,"__esModule",{value:!0}),e.inViewport=n},function(t,e){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(e,function(){return this}())},function(t,e,n){var r=n(5),o="object"==typeof self&&self&&self.Object===Object&&self,i=r||o||Function("return this")();t.exports=i},function(t,e,n){function r(t,e,n){function r(e){var n=_,r=g;return _=g=void 0,j=e,w=t.apply(r,n)}function a(t){return j=t,O=setTimeout(h,e),x?r(t):w}function l(t){var n=t-P,r=t-j,o=e-n;return T?f(o,m-r):o}function p(t){var n=t-P,r=t-j;return void 0===P||n>=e||n<0||T&&r>=m}function h(){var t=i();return p(t)?d(t):void(O=setTimeout(h,l(t)))}function d(t){return O=void 0,A&&_?r(t):(_=g=void 0,w)}function v(){void 0!==O&&clearTimeout(O),j=0,_=P=g=O=void 0}function y(){return void 0===O?w:d(i())}function b(){var t=i(),n=p(t);if(_=arguments,g=this,P=t,n){if(void 0===O)return a(P);if(T)return O=setTimeout(h,e),r(P)}return void 0===O&&(O=setTimeout(h,e)),w}var _,g,m,w,O,P,j=0,x=!1,T=!1,A=!0;if("function"!=typeof t)throw new TypeError(c);return e=u(e)||0,o(n)&&(x=!!n.leading,T="maxWait"in n,m=T?s(u(n.maxWait)||0,e):m,A="trailing"in n?!!n.trailing:A),b.cancel=v,b.flush=y,b}var o=n(1),i=n(8),u=n(10),c="Expected a function",s=Math.max,f=Math.min;t.exports=r},function(t,e,n){var r=n(6),o=function(){return r.Date.now()};t.exports=o},function(t,e,n){function r(t,e,n){var r=!0,c=!0;if("function"!=typeof t)throw new TypeError(u);return i(n)&&(r="leading"in n?!!n.leading:r,c="trailing"in n?!!n.trailing:c),o(t,e,{leading:r,maxWait:e,trailing:c})}var o=n(7),i=n(1),u="Expected a function";t.exports=r},function(t,e){function n(t){return t}t.exports=n}])})},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),i=n(1),u=function(t){function e(){var e=t.call(this)||this;return e.test=/link\.zhihu\.com\/\?target=(.*)/,e}return r(e,t),e.prototype.onScroll=function(t){},e.prototype.onHover=function(t){i.antiRedirect(t,this.test,this.config.debug)},e}(o.Provider);e.ZhihuZhuanlanProvider=u},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),i=n(1),u=function(t){function e(){var e=t.call(this)||this;return e.test=/zhihu\.com\/\?target=(.*)/,e}return r(e,t),e.prototype.onScroll=function(t){},e.prototype.onHover=function(t){i.antiRedirect(t,this.test,this.config.debug)},e}(o.Provider);e.ZhihuDailyProvider=u},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),i=function(t){function e(){var e=t.call(this)||this;return e.test=/jump\d*\.bdimg\.com/,e}return r(e,t),e.prototype.onScroll=function(t){},e.prototype.onHover=function(t){if(this.test.test(t.href)){var e="",n=t.innerText||t.textContent||"";try{e=decodeURIComponent(n)}catch(t){e=/https?:\/\//.test(n)?n:""}e&&(t.href=e,this.config.debug&&(t.style.backgroundColor="green"))}},e}(o.Provider);e.TiebaProvider=i},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),i=function(t){function e(){var e=t.call(this)||this;return e.test=/nothing/,e}return r(e,t),e.prototype.onScroll=function(t){},e.prototype.onHover=function(t){t.getAttribute("onmousedown")&&t.removeAttribute("onmousedown"),t.getAttribute("data-href")&&(t.href=t.getAttribute("data-href"),this.config.debug&&(t.style.backgroundColor="green"))},e}(o.Provider);e.GoogleProvider=i},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),i=n(1),u=function(t){function e(){var e=t.call(this)||this;return e.test=/www\.google\.com\/url\?q=(.*)/,e}return r(e,t),e.prototype.onScroll=function(t){},e.prototype.onHover=function(t){i.antiRedirect(t,this.test,this.config.debug)},e}(o.Provider);e.GoogleDocsProvider=u},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),i=n(1),u=function(t){function e(){var e=t.call(this)||this;return e.test=/zhihu\.com\/\?target=(.*)/,e}return r(e,t),e.prototype.onScroll=function(t){},e.prototype.onHover=function(t){i.antiRedirect(t,this.test,this.config.debug)},e}(o.Provider);e.ZhihuProvider=u},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),i=n(1),u=function(t){function e(){var e=t.call(this)||this;return e.test=/so\.com\/link\?url=(.*)/,e}return r(e,t),e.prototype.onScroll=function(t){},e.prototype.onHover=function(t){i.antiRedirect(t,this.test,this.config.debug),t.removeAttribute("data-res"),t.href=t.href.replace(/\&(q|t|ts|src)=[^\&]*/g,"");var e=t.getAttribute("data-url");e&&(t.setAttribute("origin-href",t.href),t.href=e,this.config.debug&&(t.style.backgroundColor="green"))},e}(o.Provider);e.SoProvider=u},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),i=function(t){function e(){var e=t.call(this)||this;return e.test=/t\.cn\/\w+/,e}return r(e,t),e.prototype.onScroll=function(t){},e.prototype.onHover=function(t){if(this.test.test(t.href)&&/^https?:\/\//.test(t.title)){var e=decodeURIComponent(t.title);e&&(t.href=e,this.config.debug&&(t.style.backgroundColor="green"))}},e}(o.Provider);e.WeboProvider=i},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),i=function(t){function e(){var e=t.call(this)||this;return e.test=/t\.co\/\w+/,e}return r(e,t),e.prototype.onScroll=function(t){},e.prototype.onHover=function(t){if(this.test.test(t.href)&&/^https?:\/\//.test(t.title)){var e=decodeURIComponent(t.title);e&&(t.href=e,this.config.debug&&(t.style.backgroundColor="green"))}},e}(o.Provider);e.TwitterProvider=i},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(t,e,n,r){var o,i=arguments.length,u=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(u=(i<3?o(u):i>3?o(e,n,u):o(e,n))||u);return i>3&&u&&Object.defineProperty(e,n,u),u};Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),u=n(0),c=n(1),s=function(t){function e(){var e=t.call(this)||this;return e.test=/www\.sogou\.com\/link\?url=/,e}return r(e,t),e.prototype.onScroll=function(t){},e.prototype.onHover=function(t){var e=this;this.test.test(t.href)&&i.default.get(t.href).then(function(n){n.finalUrl&&(t.href=n.finalUrl,e.config.debug&&(t.style.backgroundColor="green"))}).catch(function(t){console.error(t)})},e.prototype.parsePage=function(t){var e=this,n=t.responseText.replace(/(src=[^>]*|link=[^>])/g,""),r=document.createElement("html");r.innerHTML=n;var o=[].slice.call(r.querySelectorAll("#main .results a[href]"));[].slice.call(document.querySelectorAll('#main .results a[href*="www.sogou.com/link?url="]')).forEach(function(t){o.forEach(function(n){var r=c.getText(t),o=c.getText(n);t.classList.contains("str-public-btn")?(r=c.getText(t.parentNode),o=c.getText(n.parentNode)):t.classList.contains("str_img")&&(r=c.getText(t.parentNode.parentNode),o=c.getText(n.parentNode.parentNode)),r&&r===o&&(e.test.test(t.href)&&t.setAttribute("origin-href",t.href),t.href=n.href,e.config.debug&&(t.style.backgroundColor="red"))})})},e.prototype.onInit=function(){var t=this;if(/www\.sogou\.com\/web/.test(window.top.location.href)){var e=c.queryParser(window.top.location.search),n=location.protocol.replace(/:$/,"").replace("s","")+"://"+(location.host+location.pathname+e);return i.default.get(n).then(function(e){t.parsePage(e)}).catch(function(t){console.error(t)}),this}},o([c.throttleDecorator(500)],e.prototype,"onHover",null),e}(u.Provider);e.SoGouProvider=s},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(t,e,n,r){var o,i=arguments.length,u=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(u=(i<3?o(u):i>3?o(e,n,u):o(e,n))||u);return i>3&&u&&Object.defineProperty(e,n,u),u},i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function u(t){try{s(r.next(t))}catch(t){i(t)}}function c(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(u,c)}s((r=r.apply(t,e||[])).next())})},u=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(u=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(u=u.call(i,n[1])).done)return u;switch(i=0,u&&(n=[0,u.value]),n[0]){case 0:case 1:u=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(u=s.trys,!(u=u.length>0&&u[u.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3])){s.label=n[1];break}if(6===n[0]&&s.label<u[1]){s.label=u[1],u=n;break}if(u&&s.label<u[2]){s.label=u[2],s.ops.push(n);break}u[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(t){n=[6,t],i=0}finally{o=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,u,c,s={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return c={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c};Object.defineProperty(e,"__esModule",{value:!0});var c=n(2),s=n(0),f=n(1),a=function(t){function e(){var e=t.call(this)||this;return e.test=/www\.baidu\.com\/link\?url=/,e}return r(e,t),e.prototype.onScroll=function(t){var e=this;t.forEach(function(t){f.getRedirect(t)<=2&&e.test.test(t.href)&&(f.increaseRedirect(t),e.handlerOneElement(t).then(function(e){f.decreaseRedirect(t)}).catch(function(e){console.error(e),f.decreaseRedirect(t)}))})},e.prototype.handlerOneElement=function(t){return i(this,void 0,void 0,function(){var e;return u(this,function(n){switch(n.label){case 0:return[4,c.default.get(t.href)];case 1:return e=n.sent(),e.finalUrl&&(t.href=e.finalUrl,this.config.debug&&(t.style.backgroundColor="green")),[2,e]}})})},e.prototype.onHover=function(t,e){this.test.test(t.href)&&this.handlerOneElement(t).catch(function(t){console.error(t)})},e.prototype.onInit=function(){return this},o([f.throttleDecorator(500)],e.prototype,"onHover",null),e}(s.Provider);e.BaiduProvider=a},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(t,e,n,r){var o,i=arguments.length,u=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(u=(i<3?o(u):i>3?o(e,n,u):o(e,n))||u);return i>3&&u&&Object.defineProperty(e,n,u),u};Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),u=n(0),c=n(1),s=function(t){function e(){var e=t.call(this)||this;return e.test=/v\.baidu\.com\/link\?url=/,e}return r(e,t),e.prototype.onScroll=function(t){},e.prototype.onHover=function(t){var e=this;this.test.test(t.href)&&i.default.get(t.href).then(function(n){n.finalUrl&&(t.href=n.finalUrl,e.config.debug&&(t.style.backgroundColor="green"))}).catch(function(t){console.error(t)})},o([c.throttleDecorator(500)],e.prototype,"onHover",null),e}(u.Provider);e.BaiduVideoProvider=s}]);